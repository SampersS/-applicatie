<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <title>add html</title>
    <script src="./lib/prng4.js"></script>
    <script src="./lib/rng.js"></script>
    <script src="./lib/jsbn.js"></script>
    <script src="./lib/rsa.js"></script>
    <script src="./lib/base64.js"></script>
    <script src="./lib/tools.js"></script>
    <script>
        var Image = null
        const nextModeEnable = function(){
            let selecvalu = document.getElementById("Kanjimode").value;
            let kanjiElement = document.getElementById("kanjimode")
            let vocabElement = document.getElementById("vocabmode")
            let subBut = document.getElementById("btnSubmit")
            subBut.disabled = false
            kanjiElement.style.display = "none"
            vocabElement.style.display = "none"
            if(selecvalu == "charakter_tabel"){
                kanjiElement.style.display = "block"
            }else if(selecvalu == "woordenschat_tabel"){
                vocabElement.style.display = "block"
            }else{
                subBut.disabled = true
            }
        }
        const prepare = function(){
            let string = serverAddress+apiAdditions+"getGroups"
            let groepElement = document.getElementById("groepen");
            PreparePassword()
            GetDataPost(string, function(data){
                for (let index = 0; index < data.length; index++) {
                    option = new Option(data[index].naam, data[index].idgroep_namen);
                    groepElement.add( option );
                    console.log(data[index])
                }
                getMeta();
            })
        }
        const getFile = function(){
            let fileelement = document.getElementById("file_input")
            if(fileelement.files.length!=0 && fileelement.files[0].type.indexOf("image") != -1){
                console.log(fileelement.files[0].size)
                Image = fileelement.files[0]
            }
        }
        function VeNiLe(classname){
            var elms = document.getElementsByClassName(classname)
            for(var i = 0; i < elms.length; i++){
                if(elms[i].value == ""){
                    return false
                }
            }
            return true
        }
        const sendData = function(){   
            let selecvalu = document.getElementById("Kanjimode").value;
            let groepElement = document.getElementById("groepen");
            let uitspraakElement = document.getElementById("txtUitspraak")
            let betekenisElement = document.getElementById("txtBetekenis")
            let charElement = document.getElementById("txtChar")
            let kanjigeschrevenElement = document.getElementById("txtKanjiWrite")
            let notitieElement = document.getElementById("txtNotitie")
            let urlparm = []
            urlparm["pad"] = ""
            if(notitieElement.value == "") {notitieElement.value = " "}
            if(selecvalu == "charakter_tabel"){
                if(VeNiLe("v1")&&document.getElementById("file_input").files.length != 0){
                    urlparm["ap"] = "postKanji/"
                    urlparm["pad"] += groepElement.value + "/"
                    urlparm["pad"] += uitspraakElement.value +"/"
                    urlparm["pad"] += betekenisElement.value +"/"
                    urlparm["pad"] += charElement.value +"/"
                    urlparm["pad"] += Image.name + "/"
                    urlparm["pad"] += notitieElement.value+"/"
                    let formData = new FormData();
                    formData.append('file', Image);
                    var http = new XMLHttpRequest();
                    var url = serverAddress+apiIMGAdditions+Image.size;
                    http.open('POST', url+"/"+cryptograaf(Image.size, false), false);
                    http.send(formData);
                }else{
                    alert("onvolledige invoer")
                    return
                }
            }else{
                if(VeNiLe("v2")){
                    urlparm["ap"] = "postWoord/"
                    urlparm["pad"] += groepElement.value+"/"
                    urlparm["pad"] += uitspraakElement.value+"/"
                    urlparm["pad"] += kanjigeschrevenElement.value+"/"
                    urlparm["pad"] += betekenisElement.value+"/"
                    urlparm["pad"] += notitieElement.value+"/"
                }else{
                    alert("onvolledige invoer")
                    return
                }
            }
            var http = new XMLHttpRequest();
            http.open('POST', serverAddress+apiAdditions+urlparm["ap"]+urlparm["pad"]);
            http.send(cryptograaf(urlparm["pad"], true));
            //window.location.href = "menu.html"
        }
        </script>
</head>
<body onload="prepare()">
<h1>Voeg een entry toe</h1>
<div id="pwobj" style="display:none">
    <label for="txtPassword">Wachtwoord:</label><br>
    <input type="password" id="txtPassword"><br>
</div>
<p style="margin: 0px;">Selecteer je mode</p>
    <select id="Kanjimode" onchange="nextModeEnable()" class="v1 v2">
        <option value=""></option>
        <option value="charakter_tabel">Kanji</option>
        <option value="woordenschat_tabel">Woordenschat</option>   
    </select>
    <p style="margin: 0px;">welke groep?</p>
    <select name="groepen" id="groepen"></select><br>
    <label for="txtUitspraak">Uitspraak:</label><br>
    <input id="txtUitspraak" class="v1 v2"><br>
    <label for="txtBetekenis">Betekenis:</label><br>
    <input id="txtBetekenis" class="v1 v2"><br>
    <div id="kanjimode" style="display: none;">
        <label for="txtChar">Charakter:</label><br>
        <input id="txtChar" class="v1"><br>
        <label for="file_input">Afbeelding van kanji:</label><br>
        <input id="file_input" onchange="getFile()" accept="image/*" type="file"><br>
    </div>
    <div id="vocabmode" style="display: none;">
        <label for="txtKanjiWrite">In kanji geschreven:</label><br>
        <input id="txtKanjiWrite" class="v2"><br>
    </div>
    <label for="txtNotitie">Notitie:</label><br>
    <input id="txtNotitie"><br>
    <button onclick="sendData()" id="btnSubmit" disabled>Verstuur</button>
</body>
</html>